{"ast":null,"code":"/**\n * Date: 2015-10-05\n * Author: Kasper SÃ¸fren <soefritz@gmail.com> (https://github.com/kafoso)\n *\n * A truncation feature, where the ellipsis will be placed at a section within\n * the URL making it still somewhat human readable.\n *\n * @param {String} url\t\t\t\t\t\t A URL.\n * @param {Number} truncateLen\t\t The maximum length of the truncated output URL string.\n * @param {String} ellipsisChars\t The characters to place within the url, e.g. \"...\".\n * @return {String} The truncated URL.\n */\nexport function truncateSmart(url, truncateLen, ellipsisChars) {\n  var ellipsisLengthBeforeParsing;\n  var ellipsisLength;\n  if (ellipsisChars == null) {\n    ellipsisChars = '&hellip;';\n    ellipsisLength = 3;\n    ellipsisLengthBeforeParsing = 8;\n  } else {\n    ellipsisLength = ellipsisChars.length;\n    ellipsisLengthBeforeParsing = ellipsisChars.length;\n  }\n  var parse_url = function (url) {\n    // Functionality inspired by PHP function of same name\n    var urlObj = {};\n    var urlSub = url;\n    var match = urlSub.match(/^([a-z]+):\\/\\//i);\n    if (match) {\n      urlObj.scheme = match[1];\n      urlSub = urlSub.substr(match[0].length);\n    }\n    match = urlSub.match(/^(.*?)(?=(\\?|#|\\/|$))/i);\n    if (match) {\n      urlObj.host = match[1];\n      urlSub = urlSub.substr(match[0].length);\n    }\n    match = urlSub.match(/^\\/(.*?)(?=(\\?|#|$))/i);\n    if (match) {\n      urlObj.path = match[1];\n      urlSub = urlSub.substr(match[0].length);\n    }\n    match = urlSub.match(/^\\?(.*?)(?=(#|$))/i);\n    if (match) {\n      urlObj.query = match[1];\n      urlSub = urlSub.substr(match[0].length);\n    }\n    match = urlSub.match(/^#(.*?)$/i);\n    if (match) {\n      urlObj.fragment = match[1];\n      //urlSub = urlSub.substr(match[0].length);  -- not used. Uncomment if adding another block.\n    }\n    return urlObj;\n  };\n  var buildUrl = function (urlObj) {\n    var url = '';\n    if (urlObj.scheme && urlObj.host) {\n      url += urlObj.scheme + '://';\n    }\n    if (urlObj.host) {\n      url += urlObj.host;\n    }\n    if (urlObj.path) {\n      url += '/' + urlObj.path;\n    }\n    if (urlObj.query) {\n      url += '?' + urlObj.query;\n    }\n    if (urlObj.fragment) {\n      url += '#' + urlObj.fragment;\n    }\n    return url;\n  };\n  var buildSegment = function (segment, remainingAvailableLength) {\n    var remainingAvailableLengthHalf = remainingAvailableLength / 2,\n      startOffset = Math.ceil(remainingAvailableLengthHalf),\n      endOffset = -1 * Math.floor(remainingAvailableLengthHalf),\n      end = '';\n    if (endOffset < 0) {\n      end = segment.substr(endOffset);\n    }\n    return segment.substr(0, startOffset) + ellipsisChars + end;\n  };\n  if (url.length <= truncateLen) {\n    return url;\n  }\n  var availableLength = truncateLen - ellipsisLength;\n  var urlObj = parse_url(url);\n  // Clean up the URL\n  if (urlObj.query) {\n    var matchQuery = urlObj.query.match(/^(.*?)(?=(\\?|\\#))(.*?)$/i);\n    if (matchQuery) {\n      // Malformed URL; two or more \"?\". Removed any content behind the 2nd.\n      urlObj.query = urlObj.query.substr(0, matchQuery[1].length);\n      url = buildUrl(urlObj);\n    }\n  }\n  if (url.length <= truncateLen) {\n    return url;\n  }\n  if (urlObj.host) {\n    urlObj.host = urlObj.host.replace(/^www\\./, '');\n    url = buildUrl(urlObj);\n  }\n  if (url.length <= truncateLen) {\n    return url;\n  }\n  // Process and build the URL\n  var str = '';\n  if (urlObj.host) {\n    str += urlObj.host;\n  }\n  if (str.length >= availableLength) {\n    if (urlObj.host.length == truncateLen) {\n      return (urlObj.host.substr(0, truncateLen - ellipsisLength) + ellipsisChars).substr(0, availableLength + ellipsisLengthBeforeParsing);\n    }\n    return buildSegment(str, availableLength).substr(0, availableLength + ellipsisLengthBeforeParsing);\n  }\n  var pathAndQuery = '';\n  if (urlObj.path) {\n    pathAndQuery += '/' + urlObj.path;\n  }\n  if (urlObj.query) {\n    pathAndQuery += '?' + urlObj.query;\n  }\n  if (pathAndQuery) {\n    if ((str + pathAndQuery).length >= availableLength) {\n      if ((str + pathAndQuery).length == truncateLen) {\n        return (str + pathAndQuery).substr(0, truncateLen);\n      }\n      var remainingAvailableLength = availableLength - str.length;\n      return (str + buildSegment(pathAndQuery, remainingAvailableLength)).substr(0, availableLength + ellipsisLengthBeforeParsing);\n    } else {\n      str += pathAndQuery;\n    }\n  }\n  if (urlObj.fragment) {\n    var fragment = '#' + urlObj.fragment;\n    if ((str + fragment).length >= availableLength) {\n      if ((str + fragment).length == truncateLen) {\n        return (str + fragment).substr(0, truncateLen);\n      }\n      var remainingAvailableLength2 = availableLength - str.length;\n      return (str + buildSegment(fragment, remainingAvailableLength2)).substr(0, availableLength + ellipsisLengthBeforeParsing);\n    } else {\n      str += fragment;\n    }\n  }\n  if (urlObj.scheme && urlObj.host) {\n    var scheme = urlObj.scheme + '://';\n    if ((str + scheme).length < availableLength) {\n      return (scheme + str).substr(0, truncateLen);\n    }\n  }\n  if (str.length <= truncateLen) {\n    return str;\n  }\n  var end = '';\n  if (availableLength > 0) {\n    end = str.substr(-1 * Math.floor(availableLength / 2));\n  }\n  return (str.substr(0, Math.ceil(availableLength / 2)) + ellipsisChars + end).substr(0, availableLength + ellipsisLengthBeforeParsing);\n}","map":{"version":3,"names":["truncateSmart","url","truncateLen","ellipsisChars","ellipsisLengthBeforeParsing","ellipsisLength","length","parse_url","urlObj","urlSub","match","scheme","substr","host","path","query","fragment","buildUrl","buildSegment","segment","remainingAvailableLength","remainingAvailableLengthHalf","startOffset","Math","ceil","endOffset","floor","end","availableLength","matchQuery","replace","str","pathAndQuery","remainingAvailableLength2"],"sources":["../../../src/truncate/truncate-smart.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}